# تقرير شامل: نظام إدارة الأدوات والمعدات

## 📋 نظرة عامة

نظام إدارة الأدوات والمعدات هو نظام فرعي متطور ومتكامل ضمن نظام إدارة المشاريع الإنشائية، مصمم خصيصاً لإدارة ومتابعة جميع الأدوات والمعدات في مشاريع البناء والإنشاء. يوفر النظام حلولاً ذكية وشاملة لتتبع الأدوات، إدارة الصيانة، التحليلات المتقدمة، والتنبؤات الذكية.

---

## 🏗️ الهيكل المعماري للنظام

### 🗄️ قاعدة البيانات والجداول

#### 1. جدول تصنيفات الأدوات (tool_categories)
```sql
CREATE TABLE tool_categories (
  id VARCHAR PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL UNIQUE,
  description TEXT,
  icon TEXT,
  color TEXT DEFAULT '#3b82f6',
  parent_id VARCHAR REFERENCES tool_categories(id) ON DELETE CASCADE,
  is_active BOOLEAN DEFAULT true NOT NULL,
  created_at TIMESTAMP DEFAULT NOW() NOT NULL,
  updated_at TIMESTAMP DEFAULT NOW() NOT NULL
);
```

**الوظائف:**
- إنشاء تصنيفات هرمية للأدوات
- دعم التصنيفات الفرعية
- تخصيص ألوان وأيقونات لكل تصنيف
- إدارة حالة التفعيل للتصنيفات

#### 2. جدول الأدوات الرئيسي (tools)
```sql
CREATE TABLE tools (
  id VARCHAR PRIMARY KEY DEFAULT gen_random_uuid(),
  sku TEXT UNIQUE,
  name TEXT NOT NULL,
  description TEXT,
  category_id VARCHAR REFERENCES tool_categories(id),
  project_id VARCHAR REFERENCES projects(id),
  unit TEXT NOT NULL DEFAULT 'قطعة',
  
  -- خصائص الأداة
  is_tool BOOLEAN DEFAULT true NOT NULL,
  is_consumable BOOLEAN DEFAULT false NOT NULL,
  is_serial BOOLEAN DEFAULT false NOT NULL,
  
  -- معلومات مالية
  purchase_price DECIMAL(12,2),
  current_value DECIMAL(12,2),
  depreciation_rate DECIMAL(5,2),
  purchase_date DATE,
  supplier_id VARCHAR REFERENCES suppliers(id),
  warranty_expiry DATE,
  
  -- معلومات الصيانة
  maintenance_interval INTEGER,
  last_maintenance_date DATE,
  next_maintenance_date DATE,
  
  -- الحالة والموقع
  status TEXT NOT NULL DEFAULT 'available',
  condition TEXT NOT NULL DEFAULT 'excellent',
  location_type TEXT,
  location_id TEXT,
  
  -- معلومات إضافية
  serial_number TEXT,
  barcode TEXT,
  qr_code TEXT,
  image_urls TEXT[],
  notes TEXT,
  specifications JSONB,
  
  -- تتبع الاستخدام
  total_usage_hours DECIMAL(10,2) DEFAULT 0,
  usage_count INTEGER DEFAULT 0,
  
  -- تقييم الذكاء الاصطناعي
  ai_rating DECIMAL(3,2),
  ai_notes TEXT,
  
  is_active BOOLEAN DEFAULT true NOT NULL,
  created_at TIMESTAMP DEFAULT NOW() NOT NULL,
  updated_at TIMESTAMP DEFAULT NOW() NOT NULL
);
```

**الحقول الرئيسية:**
- **معرف فريد**: SKU, الرقم التسلسلي، الباركود، QR Code
- **التصنيف**: ربط بالتصنيفات الهرمية
- **المعلومات المالية**: سعر الشراء، القيمة الحالية، معدل الإهلاك
- **الصيانة**: فترات الصيانة، التواريخ المهمة
- **الحالة**: متاح، مستخدم، صيانة، معطل، متقاعد
- **الموقع**: نوع ومعرف الموقع الحالي

#### 3. جدول مخزون الأدوات (tool_stock)
```sql
CREATE TABLE tool_stock (
  id VARCHAR PRIMARY KEY DEFAULT gen_random_uuid(),
  tool_id VARCHAR NOT NULL REFERENCES tools(id) ON DELETE CASCADE,
  location_type TEXT NOT NULL,
  location_id VARCHAR,
  location_name TEXT,
  quantity INTEGER NOT NULL DEFAULT 0,
  available_quantity INTEGER NOT NULL DEFAULT 0,
  reserved_quantity INTEGER NOT NULL DEFAULT 0,
  notes TEXT,
  last_verified_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW() NOT NULL,
  updated_at TIMESTAMP DEFAULT NOW() NOT NULL,
  UNIQUE(tool_id, location_type, location_id)
);
```

#### 4. جدول حركات الأدوات (tool_movements)
```sql
CREATE TABLE tool_movements (
  id VARCHAR PRIMARY KEY DEFAULT gen_random_uuid(),
  tool_id VARCHAR NOT NULL REFERENCES tools(id) ON DELETE CASCADE,
  movement_type TEXT NOT NULL,
  quantity INTEGER NOT NULL,
  from_type TEXT,
  from_id VARCHAR,
  to_type TEXT,
  to_id VARCHAR,
  project_id VARCHAR REFERENCES projects(id),
  reason TEXT,
  notes TEXT,
  reference_number TEXT,
  performed_by TEXT NOT NULL,
  performed_at TIMESTAMP DEFAULT NOW() NOT NULL
);
```

**أنواع الحركات:**
- **purchase**: شراء جديد
- **transfer**: نقل بين المواقع
- **return**: إرجاع
- **consume**: استهلاك
- **adjust**: تعديل الكمية
- **maintenance**: نقل للصيانة
- **lost**: فقدان

#### 5. جدول سجلات الصيانة (tool_maintenance_logs)
```sql
CREATE TABLE tool_maintenance_logs (
  id VARCHAR PRIMARY KEY DEFAULT gen_random_uuid(),
  tool_id VARCHAR NOT NULL REFERENCES tools(id) ON DELETE CASCADE,
  maintenance_type TEXT NOT NULL,
  priority TEXT NOT NULL DEFAULT 'medium',
  title TEXT NOT NULL,
  description TEXT,
  work_performed TEXT,
  scheduled_date TIMESTAMP,
  started_at TIMESTAMP,
  completed_at TIMESTAMP,
  next_due_date TIMESTAMP,
  status TEXT NOT NULL DEFAULT 'scheduled',
  labor_cost DECIMAL(12,2) DEFAULT 0,
  parts_cost DECIMAL(12,2) DEFAULT 0,
  total_cost DECIMAL(12,2) DEFAULT 0,
  performed_by VARCHAR REFERENCES users(id),
  assigned_to VARCHAR REFERENCES users(id),
  condition_before TEXT,
  condition_after TEXT,
  image_urls TEXT[],
  document_urls TEXT[],
  notes TEXT,
  issues TEXT,
  recommendations TEXT,
  created_at TIMESTAMP DEFAULT NOW() NOT NULL,
  updated_at TIMESTAMP DEFAULT NOW() NOT NULL
);
```

### 🔄 المكونات الأساسية

#### 1. الواجهة الرئيسية (tools-management.tsx)
**الموقع**: `client/src/pages/tools-management.tsx`

**الوظائف الأساسية:**
- عرض شبكي وقائمة للأدوات
- فلترة متقدمة (حسب التصنيف، الحالة، الموقع)
- بحث ذكي (في الاسم، SKU، الرقم التسلسلي)
- إحصائيات فورية للأدوات

**مكونات الواجهة:**
```typescript
interface Tool {
  id: string;
  name: string;
  description?: string;
  categoryId?: string;
  projectId?: string;
  sku?: string;
  serialNumber?: string;
  barcode?: string;
  qrCode?: string;
  unit: string;
  purchasePrice?: number;
  currentValue?: number;
  depreciationRate?: number;
  purchaseDate?: string;
  warrantyExpiry?: string;
  maintenanceInterval?: number;
  nextMaintenanceDate?: string;
  status: 'available' | 'in_use' | 'maintenance' | 'damaged' | 'retired';
  condition: 'excellent' | 'good' | 'fair' | 'poor' | 'damaged';
  locationType: string;
  locationId?: string;
  specifications?: any;
  images?: string[];
  manuals?: string[];
  isActive: boolean;
  createdAt: string;
  updatedAt: string;
}
```

#### 2. نظام QR Scanner
**الموقع**: `client/src/components/tools/qr-scanner.tsx`

**الميزات:**
- مسح QR Code و Barcode
- دعم كاميرا الهاتف الأمامية والخلفية
- تشغيل/إيقاف الفلاش
- تحديد الأدوات تلقائياً
- عرض معلومات الأداة فور المسح

**السيناريوهات:**
1. **البحث السريع**: مسح رمز الأداة لعرض تفاصيلها
2. **الجرد**: مسح متسلسل للأدوات لتحديث الكميات
3. **النقل**: تأكيد هوية الأداة قبل النقل
4. **الصيانة**: تسجيل عمليات الصيانة

---

## 🛠️ الوظائف والميزات الأساسية

### 1. إدارة الأدوات

#### إضافة أداة جديدة
**الموقع**: `client/src/components/tools/add-tool-dialog.tsx`

**النموذج يتضمن:**
- **المعلومات الأساسية**: الاسم، الوصف، التصنيف
- **المعرفات**: SKU، الرقم التسلسلي، Barcode
- **المعلومات المالية**: سعر الشراء، القيمة الحالية، الإهلاك
- **الصيانة**: فترات الصيانة، تاريخ الضمان
- **الموقع**: نوع الموقع ومعرفه
- **المواصفات التقنية**: JSON منظم
- **المرفقات**: صور ومستندات

**التحقق من البيانات:**
```typescript
const addToolSchema = z.object({
  name: z.string().min(2).max(100),
  categoryId: z.string().min(1),
  unit: z.string().min(1),
  purchasePrice: z.coerce.number().min(0).max(999999).optional(),
  status: z.enum(['available', 'in_use', 'maintenance', 'damaged', 'retired']),
  condition: z.enum(['excellent', 'good', 'fair', 'poor', 'damaged']),
  // ... المزيد من الحقول
});
```

#### عرض تفاصيل الأداة
**الموقع**: `client/src/components/tools/tool-details-dialog.tsx`

**التبويبات:**
1. **المعلومات العامة**: البيانات الأساسية والحالة
2. **المعلومات المالية**: التكاليف والإهلاك
3. **الصيانة**: سجل الصيانة والجدولة
4. **الحركات**: تاريخ النقل والحركات
5. **المرفقات**: الصور والمستندات
6. **الإحصائيات**: بيانات الاستخدام والأداء

### 2. نظام التصنيفات
**الموقع**: `client/src/components/tools/tool-categories-dialog.tsx`

**الميزات:**
- تصنيفات هرمية (رئيسية وفرعية)
- ألوان وأيقونات مخصصة
- إحصائيات لكل تصنيف
- إدارة التفعيل/الإلغاء

### 3. إدارة الحركات والنقل
**الموقع**: `client/src/components/tools/tool-movements-dialog.tsx`

**أنواع العمليات:**
- **النقل بين المشاريع**: من مشروع لآخر
- **النقل للمخازن**: تخزين مؤقت
- **النقل للصيانة**: إرسال للصيانة
- **الإرجاع**: إرجاع من الاستخدام
- **التعديل**: تعديل الكميات

**بيانات كل حركة:**
- تاريخ ووقت العملية
- المصدر والوجهة
- الكمية المنقولة
- السبب والملاحظات
- المسؤول عن العملية

### 4. نظام الصيانة المتقدم

#### أنواع الصيانة:
1. **الصيانة الوقائية**: جدولة دورية
2. **الصيانة التصحيحية**: إصلاح الأعطال
3. **الصيانة الطارئة**: إصلاحات عاجلة
4. **التفتيش الدوري**: فحص دوري

#### جدولة الصيانة:
- **زمنية**: كل X أيام/أسابيع/شهور
- **استخدامية**: كل X ساعات عمل
- **حالة**: بناءً على حالة الأداة
- **مخصصة**: جدولة يدوية

---

## 🤖 الأنظمة الذكية والمتقدمة

### 1. نظام التحليلات المتقدم
**الموقع**: `client/src/components/tools/advanced-analytics-dashboard.tsx`

**المؤشرات:**
- معدل الاستخدام لكل أداة
- كفاءة الأداء
- تكلفة التشغيل
- معدل الأعطال
- توقعات الاستبدال

### 2. نظام الصيانة التنبؤية
**الموقع**: `client/src/components/tools/predictive-maintenance-system.tsx`

**الميزات:**
- تحليل أنماط الاستخدام
- توقع الأعطال
- تحسين جداول الصيانة
- تقليل التوقف غير المخطط

### 3. محرك التوصيات الذكي
**الموقع**: `client/src/components/tools/intelligent-recommendations-engine.tsx`

**التوصيات:**
- أدوات بديلة
- تحسين الاستخدام
- توقيت الشراء
- تحسين التوزيع

### 4. نظام تحسين الأداء
**الموقع**: `client/src/components/tools/smart-performance-optimizer.tsx`

**التحسينات:**
- توزيع الأدوات الأمثل
- تقليل وقت البحث
- زيادة الاستفادة
- تقليل التكاليف

### 5. نظام الإشعارات المتقدم
**الموقع**: `client/src/components/tools/advanced-notification-system.tsx`

**أنواع الإشعارات:**
- انتهاء الضمان
- موعد الصيانة
- انخفاض المخزون
- أدوات غير مستخدمة
- تحديثات الحالة

---

## 🔄 سيناريوهات الاستخدام العملية

### السيناريو الأول: إضافة أداة جديدة
1. **المستخدم يضغط على زر "إضافة أداة"**
2. **يفتح نموذج الإضافة مع التبويبات**
3. **يملأ المعلومات الأساسية (اسم، تصنيف، وحدة)**
4. **يضيف المعلومات المالية (سعر الشراء، تاريخ الشراء)**
5. **يحدد معلومات الصيانة (الفترة، تاريخ الضمان)**
6. **يضيف الموقع الحالي والمواصفات**
7. **يرفع الصور والمستندات**
8. **يحفظ الأداة في النظام**
9. **النظام ينشئ QR Code تلقائياً**
10. **يعرض رسالة تأكيد النجاح**

### السيناريو الثاني: البحث عن أداة باستخدام QR Scanner
1. **المستخدم يضغط على أيقونة QR Scanner**
2. **يفتح تطبيق الكاميرا**
3. **يوجه الكاميرا نحو QR Code للأداة**
4. **النظام يقرأ الرمز ويبحث في قاعدة البيانات**
5. **يعرض تفاصيل الأداة فوراً**
6. **يمكن عرض التفاصيل أو تعديل أو نقل الأداة**

### السيناريو الثالث: نقل أداة بين المشاريع
1. **المستخدم يبحث عن الأداة**
2. **يفتح قائمة الإجراءات > نقل**
3. **يحدد المشروع المصدر والوجهة**
4. **يدخل الكمية والسبب**
5. **يؤكد عملية النقل**
6. **النظام يسجل الحركة في سجل التتبع**
7. **يحديث موقع الأداة في قاعدة البيانات**
8. **يرسل إشعارات للمعنيين**

### السيناريو الرابع: جدولة صيانة دورية
1. **النظام يفحص تواريخ الصيانة تلقائياً**
2. **يحدد الأدوات التي تحتاج صيانة**
3. **ينشئ مهام صيانة مجدولة**
4. **يرسل إشعارات للفنيين**
5. **عند بدء الصيانة: يغير حالة الأداة**
6. **يسجل تفاصيل العمل المنجز**
7. **يحديث تاريخ الصيانة القادمة**
8. **يعيد الأداة للخدمة**

### السيناريو الخامس: تقرير الاستخدام الشهري
1. **المستخدم يختار فترة التقرير**
2. **النظام يجمع بيانات الاستخدام**
3. **يحسب المؤشرات والإحصائيات**
4. **ينشئ تقريراً مرئياً بالرسوم البيانية**
5. **يعرض توصيات التحسين**
6. **يسمح بالتصدير إلى Excel/PDF**

---

## 🔧 مسارات API والوظائف

### مسارات الأدوات الأساسية:
```
GET    /api/tools                     // جلب جميع الأدوات مع الفلاتر
GET    /api/tools/:id                 // جلب أداة محددة
POST   /api/tools                     // إضافة أداة جديدة
PUT    /api/tools/:id                 // تحديث أداة
DELETE /api/tools/:id                 // حذف أداة
```

### مسارات البحث المتقدم:
```
GET    /api/tools/search/sku/:sku           // البحث بـ SKU
GET    /api/tools/search/barcode/:barcode   // البحث بـ Barcode
GET    /api/tools/search/qr/:qrCode         // البحث بـ QR Code
```

### مسارات التصنيفات:
```
GET    /api/tool-categories            // جلب التصنيفات
POST   /api/tool-categories            // إضافة تصنيف
PUT    /api/tool-categories/:id        // تحديث تصنيف
DELETE /api/tool-categories/:id        // حذف تصنيف
```

### مسارات الحركات:
```
GET    /api/tool-movements/:toolId     // سجل حركات أداة
POST   /api/tools/:toolId/transfer     // نقل أداة
GET    /api/tool-movements/project/:projectId  // حركات مشروع
```

### مسارات الصيانة:
```
GET    /api/tool-maintenance/:toolId   // سجل صيانة أداة
POST   /api/tool-maintenance           // إضافة صيانة
PUT    /api/tool-maintenance/:id       // تحديث صيانة
GET    /api/tools/reports/needing-maintenance  // أدوات تحتاج صيانة
```

### مسارات التقارير والإحصائيات:
```
GET    /api/tools/stats/:days          // إحصائيات عامة
GET    /api/tools/usage-report/:days/:category  // تقرير الاستخدام
GET    /api/tools/categories-stats/:days        // إحصائيات التصنيفات
GET    /api/tools/maintenance-report            // تقرير الصيانة
GET    /api/tools/reports/utilization           // تقرير الاستخدام
GET    /api/tools/reports/low-stock             // المخزون المنخفض
```

---

## 📊 الإحصائيات والتقارير

### الإحصائيات الأساسية:
- **إجمالي الأدوات**: العدد الكلي في النظام
- **الأدوات المتاحة**: غير مستخدمة حالياً
- **الأدوات المستخدمة**: في العمل
- **أدوات الصيانة**: تحت الصيانة
- **الأدوات المعطلة**: تحتاج إصلاح

### تقارير متقدمة:
1. **تقرير الاستخدام**:
   - معدل الاستخدام لكل أداة
   - الأدوات الأكثر/الأقل استخداماً
   - كفاءة التوزيع

2. **تقرير الصيانة**:
   - الصيانة المجدولة والمنجزة
   - تكاليف الصيانة
   - معدل الأعطال

3. **تقرير مالي**:
   - قيمة المخزون
   - تكاليف التشغيل
   - الإهلاك المحسوب

### التصور البياني:
- رسوم بيانية دائرية للحالات
- رسوم بيانية خطية للاستخدام عبر الوقت
- رسوم بيانية شريطية للمقارنات
- خرائط حرارية لتوزيع الأدوات

---

## 🔐 الأمان والصلاحيات

### مستويات الوصول:
1. **مشاهد**: عرض المعلومات فقط
2. **مستخدم**: إضافة/تعديل الأدوات
3. **مشرف**: جميع العمليات + الحذف
4. **مدير**: إدارة النظام والإعدادات

### التدقيق والتتبع:
- تسجيل جميع العمليات مع الطوابع الزمنية
- تتبع المستخدم المسؤول عن كل عملية
- سجل مفصل للتغييرات
- نسخ احتياطية دورية

---

## 🚀 المراحل التطويرية

### المرحلة الأولى (مُنجزة):
✅ إدارة الأدوات الأساسية
✅ نظام التصنيفات
✅ QR Scanner
✅ نقل الأدوات
✅ سجل الحركات

### المرحلة الثانية (مُنجزة):
✅ نظام الصيانة المتقدم
✅ التحليلات والإحصائيات
✅ التقارير المرئية
✅ نظام الإشعارات

### المرحلة الثالثة (قيد التطوير):
🔄 ربط المشتريات بالأدوات
🔄 الذكاء الاصطناعي للتوصيات
🔄 التحليلات التنبؤية
🔄 تحسين الأداء التلقائي

### المرحلة الرابعة (مخططة):
📋 تطبيق الهاتف المخصص
📋 إنترنت الأشياء (IoT) للتتبع
📋 تقنيات الواقع المعزز
📋 التكامل مع أنظمة ERP

---

## 🎯 نقاط القوة الرئيسية

### 1. **الشمولية**:
- يغطي جميع جوانب إدارة الأدوات
- من الشراء إلى التقاعد
- تتبع شامل لدورة حياة الأداة

### 2. **سهولة الاستخدام**:
- واجهة عربية بديهية
- QR Scanner للوصول السريع
- عمليات مبسطة ومنطقية

### 3. **الذكاء والتحليل**:
- تحليلات متقدمة للاستخدام
- توصيات ذكية للتحسين
- صيانة تنبؤية لمنع الأعطال

### 4. **المرونة**:
- قابل للتخصيص حسب نوع المشروع
- يدعم أنواع مختلفة من الأدوات
- إعدادات قابلة للتعديل

### 5. **التكامل**:
- مترابط مع نظام إدارة المشاريع
- ربط مع الموردين والمشتريات
- تتبع التكاليف والميزانيات

---

## 📱 التقنيات المستخدمة

### Frontend:
- **React.js** مع TypeScript
- **Tailwind CSS** للتصميم
- **shadcn/ui** للمكونات
- **React Query** لإدارة البيانات
- **React Hook Form** للنماذج
- **Zod** للتحقق من البيانات

### Backend:
- **Express.js** مع TypeScript
- **Drizzle ORM** لقاعدة البيانات
- **PostgreSQL** (Supabase)

### مكتبات إضافية:
- **Lucide React** للأيقونات
- **html2canvas** لتصدير الصور
- **jsPDF** لتصدير PDF
- **ExcelJS** لتصدير Excel

---

## 🔧 إعدادات التطوير

### تشغيل النظام:
```bash
npm run dev
```

### بناء المشروع:
```bash
npm run build
```

### هيكل الملفات:
```
client/src/
├── pages/
│   └── tools-management.tsx           # الصفحة الرئيسية
├── components/
│   └── tools/
│       ├── add-tool-dialog.tsx        # إضافة أداة
│       ├── tool-details-dialog.tsx    # تفاصيل الأداة
│       ├── edit-tool-dialog.tsx       # تعديل الأداة
│       ├── qr-scanner.tsx             # ماسح QR
│       ├── tool-movements-dialog.tsx  # نقل الأدوات
│       ├── tool-categories-dialog.tsx # إدارة التصنيفات
│       ├── tools-reports-dialog.tsx   # التقارير
│       └── [المكونات المتقدمة]
```

---

## 📈 مؤشرات الأداء الرئيسية (KPIs)

### الاستخدام:
- معدل استخدام الأدوات: 85%+
- وقت البحث عن أداة: أقل من 30 ثانية
- دقة تتبع الموقع: 99%+

### الصيانة:
- تقليل الأعطال غير المخططة: 40%
- الالتزام بجداول الصيانة: 95%+
- متوسط وقت الإصلاح: تحسن 30%

### المالية:
- تقليل الفقدان والسرقة: 60%
- تحسين استغلال الأدوات: 25%
- دقة تقدير التكاليف: 90%+

---

## 🎉 الخلاصة

نظام إدارة الأدوات والمعدات يمثل حلاً متكاملاً وذكياً لإدارة الأدوات في مشاريع البناء والإنشاء. يجمع بين البساطة في الاستخدام والقوة في الوظائف، مما يوفر للمؤسسات الإنشائية أداة فعالة لتحسين الكفاءة وتقليل التكاليف وضمان توفر الأدوات في الوقت والمكان المناسبين.

النظام قابل للتطوير والتوسع، ويستمر في النمو بإضافة ميزات جديدة ومتطورة لمواكبة احتياجات القطاع الإنشائي المتنامية.

---

**تاريخ إعداد التقرير**: 21 أغسطس 2025  
**إعداد**: نظام الوكيل الذكي  
**الحالة**: تقرير شامل ومحدث  