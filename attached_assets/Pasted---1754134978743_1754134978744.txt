تصميم قاعدة البيانات وجدول المشتريات

لضمان فصل المعاملات الآجلة عن النقدية، يجب أن يتضمن جدول المشتريات (أو المعاملات) حقلاً يوضح نوع الدفع (نقد أم أجل). مثلاً عمود payment_type أو is_credit (قيمة منطقية) يحدد ما إذا كانت الفاتورة آجلة. بالإضافة إلى الأعمدة العادية (معرّف المورد، المشروع، تاريخ الفاتورة، المادة، الكمية، المبلغ، إلخ)، يتيح هذا الحقل التمييز بين المصروفات الآجلة والحالية. عند تسجيل فاتورة آجلة، يجب أن تُسجل كدين في حساب المورد (زيادة في حسابات الدائنين) وليس كمصروف نقدي فوري.

المحاسبة للمشتريات الآجلة

وفقاً للمبادئ المحاسبية، فإن شراء بضاعة بالأجل يزيد الأصول (مثل المخزون أو المواد) ويزيد في الوقت نفسه المطلوبات (حساب الموردين). بمعنى آخر، لا تُخصم قيمة الشراء من النقدية مباشرة، وإنما تُنزل في حساب “حسابات الدائنين”. مثلاً، قيد الفاتورة قد يكون: مدين مشتريات / دائن حساب المورد. وعند سداد هذه الفاتورة لاحقاً يُعكس القيد: مدين حساب المورد / دائن نقدية. لذلك، ينبغي في النظام تجاهل المبلغ الآجل عند حساب المصروفات اليومية حتى يتم دفعه فعلياً.

استعلامات الفلترة وإعداد التقرير

يمكن استخدام استعلامات Supabase لتنقية الحركات حسب المورد والفترة ونوع الدفع. مثلاً، لاستخراج الفواتير الآجلة لمورد ما ضمن نطاق زمني، نستخدم استعلاماً مشابهاً:

const { data, error } = await supabase
  .from('purchases')
  .select('date, project, material, quantity, amount')
  .eq('supplier_id', supplierId)    // المورد المحدد
  .eq('payment_type', 'اجل')       // الفواتير الآجلة فقط
  .gte('date', startDate)          // من تاريخ البداية
  .lte('date', endDate)            // إلى تاريخ النهاية

توفر مكتبة Supabase وظائف فلترة متسلسلة مثل .eq() و.gte() و.lte(). مثلاً .eq('payment_type','اجل') سيختار السجلات الآجلة فقط، و.gte('date', startDate).lte('date', endDate) يحدد الفترة الزمنية. يمكن أيضاً استخدام فلاتر أخرى مثل .eq('project_id', projectId) لتحديد المشروع، أو ترك .eq('payment_type') بدون شرط لعرض كل الحركات. بهذا نحقق حرية التصفية حسب الفترة والمشروع ونوع الدفع (نقد/آجل).

تنسيق التقرير وطباعته

يُجمع تقرير كشف الحساب عادة في جدول منظم يتضمن الأعمدة المطلوبة (التاريخ، المشروع، المادة أو الصنف، الكمية، المبلغ، إلخ). يُنصح بإضافة رأسية التقرير (شعار الشركة، اسم المشروع، الفترة) لجعله احترافياً. يمكن تصميم الصفحة على الويب وعرضها في متصفح ثم استخدام ميزة الطباعة (window.print()) لطباعة المستند أو حفظه كـPDF.

التصدير إلى PDF وExcel

لإنشاء تقرير PDF احترافي، يمكن استخدام مكتبات برمجية مثل jsPDF مع إضافة jsPDF-Autotable لبناء جداول منظمة بالبيانات. فعلى سبيل المثال، يعرض مطور كيفية توليد قالب فاتورة PDF كامل باستخدام jsPDF-autotable حيث يُضاف عنوان وجدول مفصل للعناصر. كما أن jsPDF يتيح ضبط الأنماط (تنسيق الخلايا، الخطوط، الألوان) ليشبه مظهر كشوف الشركات الكبرى.

أما لتصدير البيانات إلى Excel، فيمكن أولاً تحويل نتائج الاستعلام (وهي غالباً JSON) إلى مصفوفة بيانات ثم استخدام مكتبة SheetJS لإنشاء ملف XLSX للتحميل. تشرح وثائق SheetJS كيفية نقل البيانات من صيغة JSON إلى workbook جاهز للتصدير إلى Excel. وبالإضافة لذلك، توفر لوحة تحكم Supabase خياراً مباشراً لتصدير نتائج الاستعلام كملف CSV. فمن داخل SQL Editor الخاص بـSupabase يمكن تنفيذ أمر مثل SELECT * FROM table_name; ثم اختيار “Download CSV” لزوم استرجاع البيانات بسهولة. يمكن فتح هذا الملف في Excel أو تحويله إلى XLSX لاحقاً.

بالتالي، بتصميم جدول مناسب وتطبيق الفلاتر البرمجية السابقة يمكن للنظام التمييز بين المشتريات الآجلة والنقدية وحسابها بالشكل الصحيح، مع إخراج تقرير مفصل وقابل للطباعة أو التصدير. تسهّل هذه الخطوات إنشاء كشف حساب احترافي للمورد متضمناً البيانات المطلوبة مثل التاريخ والمشروع والصنف والكمية والمبلغ، مع خيارات تصدير للطباعة وPDF وExcel كما في أنظمة الشركات الكبرى.

المصادر: تم الاسترشاد بمعايير محاسبية عامة لتسجيل المشتريات الآجلة، وبوثائق Supabase حول التصفية في الاستعلامات، بالإضافة إلى مراجع تقنية حول توليد تقارير PDF وExcel باستخدام مكتبات متخصصة.

