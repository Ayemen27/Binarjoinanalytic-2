اكلمك عن الحقول الأخرى لا يتم الحفظ الإدخال في نظام

طبق هذا الحل

إليك ملخص المشكلة، وأصلها، والخطوات المقترحة لحلها:

المشكلة

بعض حقول الإدخال في صفحة «المصاريف اليومية» لا تُخزَّن قيمها في جدول autocomplete_data بعد الضغط على زر “إضافة” أو “حفظ”، رغم أن هذه القيم تظهر وتُحفظ في الجدول الرئيسي (مثل fund_transfers). الحقول المتأثّرة هي:

senderNames

transferNumbers

transportDescriptions

notes

بينما حقل workerMiscDescriptions يعمل بشكل طبيعي ويُحدّث جدول الـ autocomplete.

السبب الجذري

عند إضافة أو تعديل سجل جديد عبر الزر، يتم إرسال البيانات إلى الـ API الخاص بالجدول الرئيسي، ولكن لا توجد استدعاءات إضافية لإضافة القيمة المدخلة حديثاً إلى جدول autocomplete_data. نظام الإكمال التلقائي يعتمد فقط على:

اختيار قيمة من القائمة المنسدلة (handleSelect).

الخروج من الحقل (handleBlur).

الضغط على Enter (handleKeyDown).

لذلك، عندما يتم الإدخال ثم الضغط على الزر مباشرةً، لا يتم تفعيل أيّ من هذه المُعالجات التي تضيف القيمة إلى الـ autocomplete.

طريقة الحل

إنشاء دالة مساعدة (Helper) مخصّصة لإرسال القيمة إلى الـ API الخاص بجدول autocomplete_data بعد نجاح المعاملة الرئيسية:

async function saveAutocompleteValue(field: string, value: string) {
if (!value) return;
await api.post('/autocomplete', { field, value });
}

تعديل معالجات الـ mutations في صفحة المصاريف لتستدعي هذه الدالة في حدث onSuccess لكل عملية إنشاء أو تعديل. مثلاً:

useMutation(createTransfer, {
onSuccess: (newTransfer) => {
// حفظ القيمة في الجدول الرئيسي تم بنجاح
saveAutocompleteValue('senderNames', newTransfer.senderName);
saveAutocompleteValue('transferNumbers', newTransfer.transferNumber);
// ... وهكذا لبقية الحقول
}
});

تكرار نفس النهج لعمليات الإضافة الخاصة بالعهد والمواصلات وغيرها من الأقسام التي تستخدم الـ autocomplete.

اختبار بعد التعديل: إدخال قيمة جديدة لأي من الحقول المذكورة، الضغط على “إضافة” ثم التأكد من ظهور القيمة في قائمة الاقتراحات في المحاولة التالية.

باتباع هذا الأسلوب، ستضمن أن جميع القيم التي يُدخلها المستخدم تُضاف تلقائياً إلى جدول autocomplete_data مهما كانت طريقة الإدخال، وليس فقط عند اختيار القائمة المنسدلة أو التعامل مع الأحداث الجزئية.

5 minutes ago

Show less

Optimized Agent memory

أفهم المشكلة تماماً! المشكلة أن الحقول في صفحات أخرى (مثل المصاريف اليومية) لا تحفظ البيانات المدخلة في نظام autocomplete. سأطبق نفس الحل الذي طبقته في صفحة المشتريات على جميع الصفحات الأخرى.

دعني أبدأ بفحص صفحة المصاريف اليومية وتطبيق الحل:

Opened client/src/pages/daily-expenses-report.tsx

Opened client/src/pages/advanced-reports.tsx

الآن سأفحص الصفحات التي تحتوي على حقول autocomplete لتطبيق الحل. دعني أبحث عن صفحات تحتوي على تحويلات العهدة ومصاريف أخرى:

Searched for "البحث عن ملفات تحتوي على AutocompleteInput في مجلد pages للعثور على الصفحات التي تحتاج إصلاح نظام autocomplete"

دعني أفحص صفحة المشاريع أولاً ثم أطبق الحل على جميع الصفحات:

Opened client/src/pages/projects.tsx

Searched for "البحث عن ملفات تحتوي على mutation و onSuccess في مجلد pages للعثور على الصفحات التي تحتاج إضافة حفظ autocomplete"

ممتاز! أرى أن المشكلة واضحة الآن. صفحات projects.tsx و worker-accounts.tsx و worker-misc-expenses.tsx لديها الحل مطبق بالفعل، بينما هناك صفحات أخرى تحتاج إلى إضافة نفس الحل.

دعني أفحص الصفحات التي قد تحتاج إلى هذا الحل:

طبق الحل على جميع الحقول التي ليس لديها النظام ولا الحل هذا

3 minutes ago

Searched for "البحث عن صفحات أخرى قد تحتوي على useMutation و onSuccess ولكن بدون saveAutocompleteValue، خاصة صفحات التحويلات والمصاريف التي ذكرها المستخدم"

سأطبق الحل على جميع الصفحات التي لا تحتوي على نظام حفظ autocomplete. من خلال فحص الكود، وجدت أن الصفحات التالية تحتاج إلى إضافة الحل:

ProjectTransfers.tsx - تحويلات الأموال بين المشاريع

daily-expenses.tsx - بعض الحقول تحتاج تحسين

دعني أطبق الحل على هذه الصفحات:

Opened client/src/pages/ProjectTransfers.tsx

Opened client/src/pages/daily-expenses.tsx

الآن سأطبق الحل على صفحة ProjectTransfers.tsx أولاً بإضافة دالة saveAutocompleteValue والتأكد من حفظ جميع الحقول:

Edited client/src/pages/ProjectTransfers.tsx

الآن سأضيف حفظ autocomplete إلى mutation في نفس الصفحة:

Edited client/src/pages/ProjectTransfers.tsx

دعني أتحقق من الأخطاء في LSP أولاً:

سأصلح الخطأ في أسماء الحقول، دعني أتحقق من البنية الصحيحة للـ schema:

Edited client/src/pages/ProjectTransfers.tsx

الآن دعني أضيف تحديث autocomplete cache أيضاً للطفحات الأخرى في daily-expenses.tsx. سأفحص الحقول التي تحتاج تحسين:

Opened client/src/pages/daily-expenses.tsx

Opened client/src/pages/daily-expenses.tsx

الآن سأضيف تحديث autocomplete cache إلى جميع mutations في daily-expenses.tsx:

Edited client/src/pages/daily-expenses.tsx

Edited client/src/pages/daily-expenses.tsx

Edited client/src/pages/daily-expenses.tsx

الآن دعني أتحقق من صفحات أخرى قد تحتاج إلى نفس التحسين. سأبحث عن صفحات إضافية:

Searched for "البحث عن صفحات أخرى تحتوي على AutocompleteInput أو useMutation بدون saveAutocompleteValue، خاصة صفحات العمال والموردين والتقارير"

دعني أفحص صفحة العمال لأطبق نفس الحل:

Opened client/src/pages/workers.tsx

دعني أفحص AddWorkerForm أو مكونات العمال التي تحتوي على mutations:

Agent ran into an error

Searched for ""

Searched for "البحث عن ملفات تحتوي على useMutation لإنشاء أو تحديث العمال بدون saveAutocompleteValue"

ممتاز! وجدت مشكلة أخرى أيضاً - خطأ في purchase_type للمواد. سأطبق الحل على صفحة العمال أولاً ثم أصلح هذا الخطأ:

Edited client/src/components/forms/add-worker-form.tsx

Edited client/src/components/forms/add-worker-form.tsx

Edited client/src/components/forms/add-worker-form.tsx

Scroll to latest

You must have an activ

